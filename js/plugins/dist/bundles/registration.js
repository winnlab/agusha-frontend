/*modules/registration/registration*/
define("modules/registration/registration",["controller","lodash","core/appState","tooltipster","jquery-validation","js/plugins/tooltipster/css/tooltipster.css!","js/plugins/tooltipster/css/themes/tooltipster-agusha.css!","js/plugins/tooltipster/css/themes/tooltipster-error.css!"],function(t,e,o,i,s,r,l,n){"use strict";t&&t.__esModule||(t={"default":t}),e&&e.__esModule||(e={"default":e}),o&&o.__esModule||(o={"default":o}),i&&i.__esModule||(i={"default":i}),s&&s.__esModule||(s={"default":s}),r&&r.__esModule||(r={"default":r}),l&&l.__esModule||(l={"default":l}),n&&n.__esModule||(n={"default":n});var a=t["default"],u=(e["default"],o["default"]),d=can.Map.extend({define:{errors:{value:new can.Map({email:null,firstname:null,password:null})},email:{value:null},firstName:{value:null},password:{value:null}}}),c=function(){var t=this.element.find(".registration_inline"),e=this.element.find(".reg_box_inside"),o=e.filter(".registered"),i=e.filter(".not_registered"),s="active",r="bounce";t.addClass("drop"),setTimeout(function(){t.addClass(r)},1e3),setTimeout(function(){t.removeClass(r)},1200),setTimeout(function(){i.removeClass(s),o.addClass(s)},1400)},f=a.extend({defaults:{}},{after_init:function(){var t,e,o=$("#registration"),i=this,s=!1;return t=o.length?o.html():jadeTemplate.get("user/registration/content"),can.view.mustache("reg",t),this.data=new d,e=u.attr("user").auth,e&&e.isAuth?void can.route.attr({module:"profile"}):($("#registration").html(can.view("reg",this.data)),this.tooltip=this.element.find(".reg_box"),this.tooltip.tooltipster({position:"right",theme:"tooltipster-error",trigger:"custom"}),jQuery.validator.setDefaults({errorPlacement:function(){},showErrors:function(t,e){e.length?(i.tooltip.tooltipster("content",e[0].message),s||i.tooltip.tooltipster("show",function(){s=!0,setTimeout(function(){i.tooltip.tooltipster("disable")},5e3)})):s&&i.tooltip.tooltipster("hide",function(){s=!1,setTimeout(function(){i.tooltip.tooltipster("hide")},5e3)}),this.defaultShowErrors()},highlight:function(t,e,o){$(t).addClass(e).removeClass(o)},unhighlight:function(t,e,o){$(t).removeClass(e).addClass(o)}}),void this.element.find(".registration_form").validate({rules:{firstName:{minlength:3,required:!0},email:{email:!0,required:!0},password:{minlength:6,required:!0}},messages:{firstName:{minlength:"Имя должно быть человеческим",required:"Имя должно быть"},email:{email:"Почта введена неверно",required:"Почта должна быть"},password:{minlength:"Пароль должен быть не менее 6 символо",required:"Пароль должен быть"}}}))},".social .facebook click":function(t,e){e.preventDefault(),window.location.href="/registration/fb"},".social .vkontakte click":function(t,e){e.preventDefault(),window.location.href="/registration/vk"},".social .odnoklasniki click":function(t,e){e.preventDefault(),window.location.href="/registration/ok"},".registration_form .done click":function(t,e){var o,i=this,s=t.parents("form");return e.preventDefault(),s.valid()?(this.tooltip.tooltipster("hide"),ga("set","page",decodeURI(document.location.href)),ga("send","event","Registration","Usual"),o=this.data,void can.ajax({url:"/registration?ajax=true",method:"POST",data:o.serialize(),success:function(){o.attr({email:null,firstName:null,password:null}),c.call(i)},error:function(t){i.tooltip.tooltipster("content",t.responseJSON.err),i.tooltip.tooltipster("show",function(){setTimeout(function(){i.tooltip.tooltipster("hide")},5e3)})}})):(this.tooltip.tooltipster("content","Форма заполнена не верно"),void this.tooltip.tooltipster("show"))}});return{get default(){return f},__esModule:!0}});
