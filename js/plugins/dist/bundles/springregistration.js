/*modules/springregistration/springregistration*/
define("modules/springregistration/springregistration",["controller","core/appState","tooltipster","jquery-validation"],function(t,e,i,o){"use strict";t&&t.__esModule||(t={"default":t}),e&&e.__esModule||(e={"default":e}),i&&i.__esModule||(i={"default":i}),o&&o.__esModule||(o={"default":o});var s=t["default"],r=e["default"],n=s.extend({},{variables:function(){this.tooltip=this.element.find(".form_container"),this.counter_block=this.element.find(".counter_block"),this.success_invite=this.element.find(".success_invite"),this.active="active"},plugins:function(){var t=this,e=!1;this.tooltip.tooltipster({position:"right",theme:"tooltipster-error",trigger:"custom"}),jQuery.validator.setDefaults({errorPlacement:function(){},showErrors:function(i,o){o.length?(t.tooltip.tooltipster("content",o[0].message),e||t.tooltip.tooltipster("show",function(){e=!0,setTimeout(function(){t.tooltip.tooltipster("disable")},5e3)})):e&&t.tooltip.tooltipster("hide",function(){e=!1,setTimeout(function(){t.tooltip.tooltipster("hide")},5e3)}),this.defaultShowErrors()},highlight:function(t,e,i){$(t).addClass(e).removeClass(i)},unhighlight:function(t,e,i){$(t).removeClass(e).addClass(i)}}),this.element.find(".registration_form").validate({rules:{firstName:{minlength:3,required:!0},email:{email:!0,required:!0},password:{minlength:6,required:!0}},messages:{firstName:{minlength:"Имя должно быть человеческим",required:"Имя должно быть"},email:{email:"Почта введена неверно",required:"Почта должна быть"},password:{minlength:"Пароль должен быть не менее 6 символов",required:"Пароль должен быть"}}}),this.element.find(".invite_form").validate({rules:{firstName:{minlength:3,required:!0},email:{email:!0,required:!0}},messages:{firstName:{minlength:"Имя должно быть человеческим",required:"Имя должно быть"},email:{email:"Почта введена неверно",required:"Почта должна быть"}}})},after_init:function(){this.counter_mustache()},counter_mustache:function(){var t,e,i,o,s=$("#counter_mustache");for(t=s.length?s.html():jadeTemplate.get("user/helpers/counter_mustache"),can.view.mustache("counter_mustache",t),e=can.Map.extend({define:{duration:{value:r.attr("counter")}}}),this.data=new e,i=this.counter_block.length;i--;)o=$(this.counter_block[i]),o.html(can.view("counter_mustache",this.data))},".registration_form submit":function(t,e){e.preventDefault();var i=this;return t.valid()?(this.tooltip.tooltipster("hide"),ga("set","page",decodeURI(document.location.href)),ga("send","event","Registration","Usual"),void can.ajax({url:"/registration?ajax=true",method:"POST",data:t.serialize(),success:function(){t.find("input").val(""),can.route.attr({module:"springregistration",id:"success"},!0)},error:function(t){i.tooltip.tooltipster("content",t.responseJSON.err),i.tooltip.tooltipster("show",function(){setTimeout(function(){i.tooltip.tooltipster("hide")},5e3)})}})):(this.tooltip.tooltipster("content","Форма заполнена неверно"),void this.tooltip.tooltipster("show"))},".invite_form submit":function(t,e){e.preventDefault();var i=this;t.valid()&&can.ajax({url:"/registration/spring_invite",method:"POST",data:t.serialize(),success:function(e){e.err||(i.success_invite.addClass(i.active),t.find("input").val(""))},error:function(t,e,i){var o=t.responseJSON.err||i;alert(o)}})},".success_invite .close click":function(){this.success_invite.removeClass(this.active)}});return{get default(){return n},__esModule:!0}});
